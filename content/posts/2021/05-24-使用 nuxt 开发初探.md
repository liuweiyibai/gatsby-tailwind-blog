---
title: ä½¿ç”¨ nuxt å¼€å‘åˆæ¢
date: 2021-05-24 20:00:30
category:
  - ç¼–ç¨‹ç¬”è®°
tags: ['vue', 'nuxt']
slug: using-nuxt-development
thumbnail: '../../thumbnails/nuxt.png'
---

## å‰è¨€

nuxt.js æ˜¯ vue é…å¥—çš„ ssr æ¸²æŸ“æ¡†æ¶ã€‚ç”¨æ¥å®ç°æœåŠ¡ç«¯æ¸²æŸ“æ•ˆæœï¼Œå³æœåŠ¡ç«¯ç›´æ¥è¿”å›é™æ€ htmlï¼Œå‡å°‘é¦–é¡µåŠ è½½èµ„æºæ—¶ç™½å±çš„æ—¶é—´ï¼Œæœ‰åˆ©äº sso ä¼˜åŒ–ï¼Œç›®å‰æˆ‘ä»¬å›¢é˜Ÿæœ‰å‡ ä¸ªé¡µé¢è¦æ±‚è¿›è¡Œ sso ä¼˜åŒ–ï¼Œå› ä¸ºæŠ€æœ¯æ ˆç”¨çš„æ˜¯ vueï¼Œæ‰€ä»¥æœåŠ¡ç«¯æ¸²æŸ“æ¡†æ¶é€‰æ‹©äº† nuxt

> nuxt.js æ˜¯ä¸€ä¸ªåŸºäº Vue.js çš„é€šç”¨åº”ç”¨æ¡†æ¶ å®ƒé¢„è®¾äº†åˆ©ç”¨ Vue.js å¼€å‘æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSR, Server Side Renderï¼‰ çš„åº”ç”¨æ‰€éœ€è¦çš„å„ç§é…ç½®ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸€é”®ç”Ÿæˆé™æ€ç«™ç‚¹ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œnuxt æ˜¯åŸºäº node.js çš„ï¼Œåç«¯å¦‚æœæ˜¯å…¶ä»–è¯­è¨€æ—¶ï¼Œæ˜¯å¦è€ƒè™‘åˆ°å†åŠ ä¸€å±‚ node.js çš„åˆç†æ€§ã€‚
>
> [å®˜æ–¹ä¸­æ–‡æ–‡æ¡£](https://zh.nuxtjs.org/guide/installation)

## åˆ›å»ºé¡¹ç›®

æŒ‰ç…§å®˜æ–¹æ–‡æ¡£èµ°å°±å¯ä»¥äº†ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ ssr æœåŠ¡ç«¯æ¸²æŸ“æ¨¡å¼

```bash
yarn create nuxt-app nuxt-demo
cd ./nuxt-demo
yarn dev
```

ä¸€ä¸ªåŸºç¡€çš„ nuxt é¡¹ç›®å°±å·²ç»å¯åŠ¨èµ·æ¥äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹åŸºäºè¿™ä¸ªæ‰©å±•ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œä»¥ä¸ºæˆ‘ä»¬æ˜¯ç§»åŠ¨ç«¯çš„é¡¹ç›®ï¼Œæ‰€ä»¥éœ€è¦é…ç½® css çš„å•ä½è½¬æ¢ï¼Œpostcssï¼Œvant çš„æŒ‰éœ€å¼•å…¥ç­‰ã€‚

## meta

nuxt å†…éƒ¨ä½¿ç”¨ vue-meta æ¥å¿«é€Ÿé…ç½®å„ä¸ªé¡µé¢æˆ–è€…ï¼Œæ•´ä¸ª website çš„ meta ä¿¡æ¯ï¼Œ[æ–‡æ¡£åœ°å€](https://nuxtjs.org/docs/2.x/features/meta-tags-seo)

```js
// nuxt.config.js
export default {
  head: {
    title: 'my website title',
    meta: [
      { charset: 'utf-8' },
      { name: 'viewport', content: 'width=device-width, initial-scale=1' },
      {
        hid: 'description',
        name: 'description',
        content: 'my website description'
      }
    ],
    link: [{ rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }]
  }
}
```

## vant

vant æŒ‰éœ€åŠ è½½

```bash
# è¿˜æ˜¯æŒ‡å®šç‰ˆæœ¬å®‰è£…ï¼Œä¸ç„¶æœ‰å‘
yarn add babel-plugin-import less@3.10.3 less-loader@5.0.0
```

```js
// nuxt.config.js
module.exports = {
  build: {
    // æ·»åŠ è¿™ä¸ªæ˜¯å…³é”®ï¼Œæ·»åŠ å babel æ‰ä¼šå¤„ç†ä¾èµ–åŒ… vant é‡Œé¢çš„ä»£ç 
    transpile: [/vant.*?less/],
    babel: {
      plugins: [
        [
          'import',
          {
            libraryName: 'vant',
            style: name => {
              return `${name}/style/less.js`
            }
          },
          'vant'
        ]
      ]
    }
  },

  // ä¹Ÿå¯ä»¥ä¿®æ”¹ vant å†…éƒ¨ less å˜é‡
  loaders: {
    less: {
      javascriptEnabled: true,
      modifyVars: {
        'nav-bar-title-font-size': '80px'
      }
    }
  }
}
```

## sass

```bash
# å®‰è£… sass-loader æŒ‡å®šç‰ˆæœ¬ï¼Œå› ä¸ºé«˜ç‰ˆæœ¬æœ‰å…¼å®¹æ€§çš„å‘
yarn add sass-loader@10 sass --dev

# åŠ è½½ less styls sass å˜é‡
yarn add @nuxtjs/style-resources --dev
```

å¯¹åº”åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨

```js
// nuxt.config.js
module.exports = {
  // å…¨å±€ css æ ·å¼ä¸€å¦‚ï¼Œpsï¼šå•ç‹¬çš„ scss æ–‡ä»¶ä¸­ä½¿ç”¨å˜é‡è¦å•ç‹¬å¼•å…¥
  css: ['@/assets/scss/main.scss'],
  buildModules: ['@nuxtjs/style-resources'],
  styleResources: {
    // your settings here
    sass: [],
    scss: [
      // éœ€è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å…¥
      './assets/vars/*.scss',
      './assets/abstracts/_mixin.scss'
    ],
    less: [],
    stylus: []
  }
}
```

å°±å¯ä»¥åœ¨ vue ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ scss å˜é‡äº†

## rem å¤„ç†

```bash
yarn add amfe-flexible
yarn add postcss-pxtorem@5.1.1 --dev # é¿å…æŠ¥é”™ï¼Œå®‰è£…æŒ‡å®šç‰ˆæœ¬
```

[ä¸ºä»€ä¹ˆé€‰ç”¨ postcss-pxtorem](https://www.npmtrends.com/postcss-plugin-px2rem-vs-postcss-px2rem-vs-postcss-pxtorem) npm ä¸‹è½½é‡æœ€é«˜ï¼

è¿™ç§æœåŠ¡ç«¯æ¸²æŸ“ï¼Œæœ€åˆé€‚çš„ç§»åŠ¨ç«¯é€‚é…æ–¹æ¡ˆåº”è¯¥æ˜¯ vw æ–¹æ¡ˆï¼Œä½†æ˜¯æˆ‘å¸äº§å“è¦æ±‚å®ç°åœ¨ pc ç«¯ä¹Ÿè¦ä¿æŒç§»åŠ¨ç«¯é¡µé¢çš„å®½åº¦ï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡ 640pxï¼Œå®¹å™¨çš„å®½åº¦æœ€å¤§å°±æ˜¯ 640pxï¼Œå¹¶ä¸”å­—ä½“å¤§å°è¦æŒ‰ç…§ 640px å®½åº¦æ¥è®¡ç®—ï¼Œæ‰€ä»¥ vw æ–¹æ¡ˆè¢« passã€‚

å¦‚æœä½¿ç”¨ plugins æ–¹å¼è½½å…¥ amfe-flexible æ’ä»¶ï¼Œä¼šé€ æˆé¡µé¢ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æœ‰é—ªçƒé—®é¢˜ã€‚å› ä¸ºä½¿ç”¨ plugins è½½å…¥æ­¤æ’ä»¶ js æ—¶ï¼Œå¯èƒ½ä¼šåœ¨æ–‡æ¡£åŠ è½½ç»“æŸä¹‹åï¼Œæ‰åŠ è½½æ­¤ jsï¼Œæ‰€ä»¥æ­¤ js å¯èƒ½åœ¨æ–‡æ¡£åŠ è½½å®Œæˆä¹‹åæ‰æ‰§è¡Œï¼Œæ‰€ä»¥å¯¼è‡´é¡µé¢é‡æ–°è®¡ç®—å•ä½å¤§å°ï¼Œæ‰€ä»¥åº”è¯¥åœ¨ head ä¸­å¯¼å…¥æ¬¡ jsï¼Œåœ¨æ–‡æ¡£æœ€é¡¶å±‚æ‰§è¡Œï¼Œé¿å…æ­¤é—®é¢˜ã€‚

```js

```

## env

```bash
# dotenv è½½å…¥ç¯å¢ƒæ–‡ä»¶
yarn add @nuxtjs/dotenv --dev
```

å¯¹åº”ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```js
module.exports = {
  modules: [
    ...,
    // Simple usage
    '@nuxtjs/dotenv',

    // With options
    [
      '@nuxtjs/dotenv',
      {
        /* module options */
      },
    ],
  ],
}
```

## æ—¥å¿—

[npm](https://www.npmjs.com/package/nuxt-winston-log)

```bash
yarn add nuxt-winston-log
```

## æ„å»º

[æ„å»ºç›¸å…³é…ç½®æ–‡æ¡£](https://nuxtjs.org/docs/2.x/configuration-glossary/configuration-build)ï¼Œå¯ä»¥ä¿®æ”¹æ„å»ºäº§ç‰©ç›¸å…³é…ç½®

```js
// nuxt.config.js
module.exports = {
  build: {
    // css ç‹¬ç«‹æ‰“åŒ… link çš„å½¢å¼åŠ è½½
    extractCSS: { allChunks: true },

    // æŒ‡å®šæ‰“åŒ…è·¯å¾„ä¸ºdistï¼Œé»˜è®¤è·¯å¾„ä¸º [_nuxt] æˆ–è€…å¯ä»¥æŒ‡å®šcdn åŸŸå
    publicPath: '/static/',

    // css å’Œ jsã€img æ‰“åŒ…æ—¶æŒ‡å®šæ–‡ä»¶å¤¹
    filenames: {
      app: ({ isDev }) => (isDev ? '[name].js' : '[chunkhash].js'),
      chunk: ({ isDev }) => (isDev ? '[name].js' : '[chunkhash].js'),
      css: ({ isDev }) => (isDev ? '[name].js' : '[contenthash].css'),
      img: ({ isDev }) => (isDev ? '[path][name].[ext]' : '[hash:7].[ext]')
    }
  }

  // è¾“å‡º css link è·¯å¾„ä¼šä¿®æ”¹ä¸ºï¼š /static/[contenthash].css
  // æ³¨æ„ï¼šé™æ€èµ„æºæ–‡ä»¶è·¯å¾„åä¸èƒ½å’Œé¡µé¢è·¯ç”±åç§°ç›¸åŒï¼ŒpublicPath é»˜è®¤é…ç½® '/' æ— æ•ˆ
}
```

## å…¶ä»–ä½¿ç”¨ç»†èŠ‚

- å¯ä»¥ä½¿ç”¨ middleware æ¥ä»£æ›¿ å…¨å±€è·¯ç”±é’©å­çš„å·¥ä½œ

  åœ¨ nuxt ä¸­ä½¿ç”¨ å…¨å±€è·¯ç”±é’©å­ï¼Œç©ä¸æ˜ç™½å°±ä¼šæ­»å¾ªç¯ ğŸ˜‘

- ä½¿ç”¨ nuxt ä¸º vuex æä¾›çš„ nuxtServerInit æä¾›çš„å‡½æ•°

  æ¯”å¦‚ website è½½å…¥ä¹‹å‰ store éœ€è¦å­˜å‚¨å“ªäº›æ•°æ®

## éƒ¨ç½²

- pm2

  ```bash
  build # æ„å»ºé™æ€æ–‡ä»¶å’Œserverä»£ç 
  yarn start # å¯åŠ¨ nuxt æä¾›çš„ node server
  # pm2 å¯åŠ¨
  pm2 start npm --name "nuxt-demo" -- run start
  ```

- docker

  docker éƒ¨ç½²æ—¶æ˜¯å¦ä¾èµ–ä½¿ç”¨ pm2ï¼Œä¸ä½¿ç”¨çš„çš„è¯

  ```dockerfile
  FROM node:alpine

  WORKDIR /app

  RUN npm i -g pm2
  RUN npm i yarn -g

  COPY ./package*.json ./

  RUN yarn install \
    --prefer-offline \
    --frozen-lockfile \
    --non-interactive \
    --production=false

  # Build app
  RUN yarn run build

  RUN rm -rf node_modules && \
    NODE_ENV=production yarn install \
    --prefer-offline \
    --pure-lockfile \
    --non-interactive \
    --production=true

  EXPOSE 3000

  USER node

  CMD [ "pm2-runtime", "start", "npm", "--", "start" ]
  ```

## æœ€å

æœ€åæ”¾ä¸€å¼  nuxt çš„ç”Ÿå‘½å‘¨æœŸå›¾å§ï¼

![nuxt ç”Ÿå‘½å‘¨æœŸå›¾](https://cdn.clearlywind.com/static/images/nuxt-lifecycle.png)
