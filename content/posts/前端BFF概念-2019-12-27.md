---
title: 前端 BFF 概念
date: 2019-12-27 19:01:31
category:
  - 编程笔记
tags: ['前端工程化']
slug: the-front-end-bff-concept
thumbnail: '../thumbnails/tag.png'
---

## 什么是 BFF

BFF 层全称是 Backend For Frontend，意思是专门为前端服务的一层服务层，是轻逻辑、与前端重耦合、时效短的一层后端接口服务，这类接口紧贴产品逻辑、视觉细节，数据往往来源于稳定、公用的领域服务，接入 BFF 层后在特定的场景下能够大幅度提升产品研发效率。

## 解决了什么问题

1. 接口数据高度可以高度自定义，不在依靠后端上游服务，根据具体前端平台区分数据格式，达到接口数据和上游后端低耦合和前端高耦合的效果
2. 当对接对个微服务时，需要同时访问多个接口，还要对多个接口数据做处理时。服务间通过 rpc 调用，调用速度会提升很多。
3. 敏感字段泄露，通过 bff 层将敏感字段重新包装
4. 后端上游服务与需求弱绑定，通过 bff 层灵活对接业务需求。
5. 减少后端和前端的撕逼概率
   - 后端仅仅关注核心业务，不再关心用户界面。不管最终产品形式是 Web 网页，App，还是公众号，还是小程序，核心逻辑都不变，都一样，都不需要后端关心。
   - 后端仅仅提供通用业务接口，不再关心数据怎么展示，比如不管是导出 PDF，导出 Excel，还是在表格里展示，都是数据的一种显示形式，和核心业务无关，因此交给前端更加合适。

- 缺点也有很多（❗️其实是风险）

  1. 增多了数据流链路，不利于排查和定位问题，站点数量增加，部署更复杂
  2. 增加了前后端开发人员的技术要求
  3. 增加了整体框架的复杂程度
  4. 前端增加了开发工作量，对前端开发的能力要求更高，比如至少要掌握 Node，以及后端开发思想。
  5. 对前端开发的人力需求更大，这个是很明显的，前端多了 BFF 层的开发工作。
  6. 对后端开发的能力要求更高。以前后端只对应一个前端，只需要提供前端需要的接口就行了，使用 BFF 以后，后端就显得更加抽象一些，后端开发的时候可能跟不知道产品形态，也只能通过单元测试或 postman 等工具来测试。如果一个接口设计的不好，或者产品需要发生变化，可能需要同时维护多个版本。
  7. 多了一些内网请求，性能怎么破？一般情况下后端提供 HTTP 协议的接口，对于性能有瓶颈的，也可以采用 rpc 方式。相信通过合理拆分接口，合理使用缓存这个问题影响不大。

## 实际开发中如何使用

使用 bff 层相当于增加了一个新的服务，因此需要考虑好语言的选择以及对应的基础建设、负载均衡、缓存的使用、应用性能监控、完善的日志系统等。

还有个图拆分BFF的工作流程：
![bff流程](https://cdn.clearlywind.com/blog-images/images/bff-workflow.png)

## 总结

BFF 层在特定的场景并且条件支持的情况下，在研发效能上的提高是毋庸置疑的，对用户体验来讲也是有一定的提升，对前端人员来说，将复杂的接口汇聚逻辑写在 BFF 层，前端页面只负责 UI 渲染，分层后的代码可阅读性、可维护性得到改善。但是无论收益点有多大，需要切记的一点是上文提到的陷阱，如果不能解决这些核心问题，使用BFF 层后，产品的稳定性会有不可控的风险，除此之外，BFF 层适用的场景有限，更不能为了赶潮流而使用。
