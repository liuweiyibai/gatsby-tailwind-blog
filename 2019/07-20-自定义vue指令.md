---
title: 自定义 vue 指令
tags:
  - vue
category:
  - 编程笔记
slug: custom-vue-instructions
thumbnail: '../../thumbnails/vue.png'
date: 2019-07-20 09:23:22
---

在 `vue` 中我们可以通过自定义指令，来对 `dom` 元素进行底层操作，我们顺便复习下如何自定义一个指令，主要包含 5 个钩子函数

## 如何定义

- 定义方式

  - 全局定义

    ```js
    Vue.directive('focus', {
      // 当被绑定的元素插入到 dom 中时
      inserted: function (el) {
        // 聚焦元素
        el.focus()
      }
    })
    ```

  - 局部定义

    ```js
    directives:{
      focus:{
        inserted: function (el) {
          el.focus()
        }
      }
    }
    ```

- 定义过程中可用的钩子函数

  ```js
  bind :function(el, binding, vnode){
    // 📌 一旦指令附加到元素时触发
    // 只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置
  }
  inserted :function(el, binding, vnode){
    // 一旦元素被添加到父元素时触发
  }
  update :function(el, binding, vnode, oldVnode){
    // 📌 每当元素本身更新(但是子元素还未更新)时触发
  }
  componentUpdate :function(el, binding, vnode, oldVnode){
    // 每当组件和子组件被更新时触发
  }
  unbind :function(el, binding, vnode){
    // 📌 一旦指令被移除时触发
  }
  ```

- 钩子函数中的参数都是什么

  [官方文档](https://cn.vuejs.org/v2/guide/custom-directive.html)

- 自定义一个指令

  ```js
  Vue.directive('directiveName', {
    bind: function (el, binding, vnode) {
      // 当指令第一次绑定元素el时触发，常用来做初始化
    },
    update: function (el, binding, vnode) {
      // 绑定 Vue 编译生成的虚拟节点 Vnode 更新时调用
    },
    unbind: function (el, binding, vnode) {
      // 解绑操作，用来将指令和元素解绑时调用，类似vue生命周期中的beforeDestroy钩子函数
    }
  })

  // 给绑定的元素通过v-style添加样式
  Vue.directive('style', {
    bind: function (el, binding) {
      el.style.position = 'fixed'
      el.style.top = binding.value.top + 'px'
      el.style.left = binding.value.left + 'px'
    }
  })
  ```

  如何使用

  ```html
  <div class="header" v-style="{left:'20px',top:'20px'}">我是header</div>
  ```

## 常用的第三方指令

[常用的 Vue 自定义指令集合](/blog/common-vue-custom-command-set)
