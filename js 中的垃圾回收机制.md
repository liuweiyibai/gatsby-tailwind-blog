---
title: js 中的垃圾回收机制
date: 2021-03-21 14:07:45
category:
  - 编程笔记
tags: ['js']
slug: the-garbage-collection-mechanism-in-the-js
thumbnail: ''
---

JavaScript 在创建变量（对象、字符串等）时分配内存，并在不再使用时**自动**释放它，这个过程称为垃圾收集。自动释放资源的这种看似**自动**的过程，其实会导致一些 JavaScript 使用者忽略内存管理这回事。在自动内存管理中存在一些问题（例如垃圾收集器中的错误或实现限制等），开发人员必须了解这些问题才能正确处理它们。

### 可达性

可达性是 JavaScript 内存管理的主要概念。可访问和可用的值称为可达。基本可达值：

1. 局部变量和当前函数参数。
2. 嵌套调用的当前链上其他函数的参数和变量。
3. 全局变量。

上述值称为根。一旦一个变量可以通过引用链或单个引用从根访问，则称为可达。
一个局部变量内的对象。如果该对象具有引用另一个对象的属性，则该对象称为可达。

被引用与可访问（从一个根）不同：一组相互连接的对象可能整体都不可达。

## 变量的生命周期

当一个变量的生命周期结束之后它所指向的内存就应该被释放。在 JavaScript 有全局变量和在函数中产生的局部变量。局部变量的生命周期在函数执行过后就结束了，此时便可将它引用的内存释放（即垃圾回收），但全局变量生命周期会持续到浏览器关闭页面。

## 垃圾回收器

在 JavaScript 中，存在一个后台进程，称为垃圾收集器。它能够监视所有对象并删除无法访问的对象。它的工作是跟踪内存的分配和使用，以便发现何时不再需要一块已分配的内存，然后它会自动释放这块内存。

垃圾回收是自动完成的，我们不能强制执行或是阻止执行。当对象是可达状态时，它一定是存在于内存中的。

## 垃圾收集算法

- 标记清除
  垃圾收集器在运行的时候会给存储在内存中的所有变量都加上标记，去掉已经被标记为引用的的变量，在此之后再被标记的变量将被视为准备删除的变量。最后垃圾回收器清除标记的变量，回收它们所占用的内存空间
  目前主流浏览器都是使用标记清除式的垃圾回收策略，只不过收集的间隔有所不同

  未被引用的变量包括不可达变量，声明未使用的变量，定期执行标记根，标记引用，没有被引用的变量将被回收

- 引用计数

  跟踪记录每个值被引用的次数，当某个变量的引用次数为 0 的时候，该变量就被下一次辣鸡回收所回收

  如果有零个引用指向一个对象，则该对象被认为是可以回收的。

## 参考地址

[前端面试：谈谈 JS 垃圾回收机制](https://segmentfault.com/a/1190000018605776)

[JavaScript 垃圾回收机制](https://zhuanlan.zhihu.com/p/60336501)

[javascript 垃圾回收机制 - 标记清除法/引用计数/V8 机制](https://segmentfault.com/a/1190000019276047)

[JavaScript 中的垃圾回收和内存泄漏](https://blog.fundebug.com/2019/04/30/javascript-memory-management/)
