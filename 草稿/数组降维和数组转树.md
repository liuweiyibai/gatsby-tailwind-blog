# 树结构转数组、数组转树

树转数组

```js
/**
 * 将平行父子数据结构转为层次结构
 * @param nodes
 * @returns {Array}
 */
function nodes2Array(nodes) {
  if (!nodes) return [];
  let childKey = 'children',
    r = [];
  if (nodes instanceof Array) {
    for (let i = 0, l = nodes.length; i < l; i++) {
      r.push(nodes[i]);
      if (nodes[i][childKey]) r = r.concat(nodes2Array(nodes[i][childKey]));
    }
  } else {
    r.push(nodes);
    if (nodes[childKey]) r = r.concat(nodes2Array(nodes[childKey]));
  }
  return r;
}
```

数组转树

```js
/**
 * 将一个层次的数据结构，转换为平行的父子数据结构
 * @param nodesArray
 * @returns {*}
 */
function array2Nodes(nodesArray) {
  let i,
    l,
    key = 'id',
    parentKey = 'parentId',
    childKey = 'children';
  if (!key || key == '' || !nodesArray) return [];

  if (nodesArray instanceof Array) {
    let r = [];
    let tmpMap = {};
    for (i = 0, l = nodesArray.length; i < l; i++) {
      tmpMap[nodesArray[i][key]] = nodesArray[i];
    }
    for (i = 0, l = nodesArray.length; i < l; i++) {
      if (tmpMap[nodesArray[i][parentKey]] && nodesArray[i][key] != nodesArray[i][parentKey]) {
        if (!tmpMap[nodesArray[i][parentKey]][childKey]) tmpMap[nodesArray[i][parentKey]][childKey] = [];
        tmpMap[nodesArray[i][parentKey]][childKey].push(nodesArray[i]);
      } else {
        r.push(nodesArray[i]);
      }
    }
    return r;
  } else {
    return [nodesArray];
  }
}
```
