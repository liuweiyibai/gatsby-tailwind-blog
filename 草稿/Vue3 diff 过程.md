---
title: Vue3 diff 过程
---

Vue2.x 中的 DOM diff 是进行全量的对比，在运行时会对所有节点生成一个虚拟节点树，当页面数据发生变更好，会遍历判断 虚拟 DOM 所有节点（包括一些不会变化的节点）有没有发生变化；虽然说 diff 算法确实减少了多 DOM 节点的直接操作，但是这个减少是有成本的，如果是复杂的大型项目，必然存在很复杂的父子关系的 VNode，而 Vue2.x 的 diff 算法，会不断地递归调用 patchVNode，不断堆叠而成的几毫秒，最终就会造成 VNode 更新缓慢。

Vue3.0 中是如何优化 DOM diff 过的呢？

## 动静结合

Vue3.0 对于虚拟 DOM 的 Patch 过程采用动静结合的方式。

在 Vue3.0 中，在模版编译时，编译器会在动态标签末尾加上 /_ Text_/ PatchFlag。也就是在生成 VNode 的时候，同时打上标记，在这个基础上再进行核心的 diff 算法并且 PatchFlag 会标识动态的属性类型有哪些，比如这里的 TEXT 表示只有节点中的文字是动态的。而 patchFlag 的类型也很多。这里直接引用一张图片。
